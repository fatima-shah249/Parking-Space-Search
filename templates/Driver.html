{% extends "base.html" %}
{% block title %}Find Nearby Parking{% endblock %}

{% block content %}
<div class="bg-white rounded-xl shadow-md p-6 mb-6">
    <h1 class="text-3xl font-bold text-gray-900 mb-2 text-center">Nearby Parking Zones</h1>
    <p class="text-gray-600 text-center mb-4">Showing zones within 2 km from your current location</p>
    <div class="text-center bg-gray-100 p-4 rounded-lg shadow">
        <strong class="text-gray-800">üìç Current Location:</strong>
        <p class="text-gray-600 mt-1">{{ User_location }}</p>
    </div>
</div>

<!-- Google Map -->
<div id="map" class="w-full h-[600px] rounded-xl shadow-md"></div>

<script>
function initMap() {
    const userLocation = { lat: {{ lat }}, lng: {{ lng }} };

    const map = new google.maps.Map(document.getElementById("map"), {
        center: userLocation,
        zoom: 14,
    });

    // Blue marker for user
    new google.maps.Marker({
        position: userLocation,
        map,
        title: "You are here",
        icon: {
            url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
        }
    });

    // Add nearby parking markers
    const nearbySlots = {{ slots|tojson }};
    nearbySlots.forEach(slot => {
        new google.maps.Marker({
            position: { lat: parseFloat(slot.latitude), lng: parseFloat(slot.longitude) },
            map,
            title: `${slot.location} - Available: ${slot.available_slots}`,
            icon: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
        });
    });
}
</script>

<!-- Load Google Maps -->
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&callback=initMap">
</script>
{% endblock %}
